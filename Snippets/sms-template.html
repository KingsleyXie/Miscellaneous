<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<title>短信批量生成工具</title>
	<link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/bootstrap-fileinput/4.5.1/css/fileinput.min.css">
	<link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/bootstrap-fileinput/4.5.1/themes/explorer/theme.min.css">
</head>

<body>
	<br><center><h1>短信批量生成工具</h1></center><br><br><br>

	<input type="file" class="file" id="file" name="file">

	<div id="cols"></div>

	<script src="https://cdnjs.loli.net/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://cdnjs.loli.net/ajax/libs/bootstrap-fileinput/4.5.1/js/plugins/piexif.min.js"></script>
	<script src="https://cdnjs.loli.net/ajax/libs/bootstrap-fileinput/4.5.1/js/plugins/sortable.min.js"></script>
	<script src="https://cdnjs.loli.net/ajax/libs/bootstrap-fileinput/4.5.1/js/plugins/purify.min.js"></script>
	<script src="https://cdnjs.loli.net/ajax/libs/popper.js/1.0.0/popper.min.js"></script>
	<script src="https://cdnjs.loli.net/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.loli.net/ajax/libs/bootstrap-fileinput/4.5.1/js/fileinput.min.js"></script>
	<script src="https://cdnjs.loli.net/ajax/libs/bootstrap-fileinput/4.5.1/themes/explorer/theme.min.js"></script>
	<script src="https://cdnjs.loli.net/ajax/libs/bootstrap-fileinput/4.5.1/js/locales/zh.js"></script>



	<script>
		$("#file").fileinput({
			theme: 'explorer',
			language: 'zh',
			browseLabel: '浏览',
			dropZoneTitle:
				'<p>请上传 Excel 文件后选取数据列并输入短信模板</p>' +
				'<p><strong>点击右下角浏览按钮选择文件</strong>' +
				'或 <strong>直接将文件拖拽到这里</strong></p>',
			showUpload: false,
			allowedFileExtensions: ['xls', 'xlsx'],
			maxFileSize: 500000,
			maxFileCount: 1,
			previewFileExtSettings: {
				'xls': function(ext) { return ext.match(/(xls|xlsx)$/i); }
			}
		});
	</script>



	<script src="https://cdnjs.loli.net/ajax/libs/xlsx/0.8.1/xlsx.core.min.js"></script>
	<script>
		let worksheet = null;
		function handleFile(e) {
			var reader = new FileReader();
			reader.onload = function(e) {
				var data = e.target.result;
				var workbook = XLSX.read(data, {type: 'binary'});
				worksheet = workbook.Sheets[workbook.SheetNames[0]];

				var columns = XLSX.utils.decode_range(worksheet['!ref']).e.c;
				var startRow = 0;

				// Check if there is a title row by where the last column of first row is set
				var finalCellPos = XLSX.utils.encode_cell({c: columns, r: 0});
				// var finalCellPos = worksheet['!ref'].replace(/.*:([A-Za-z]*)\d*/, '$1') + '1';
				if (worksheet[finalCellPos] == undefined) startRow++;

				for (var col = 0; col <= columns; col++) {
					var pos = XLSX.utils.encode_cell({c: col, r: startRow});
					console.log(worksheet[pos].w);
				}
			};
			reader.readAsBinaryString(e.target.files[0]);
		}

		document.getElementById('file')
		.addEventListener('input', handleFile, false);
	</script>
</body>
</html>
